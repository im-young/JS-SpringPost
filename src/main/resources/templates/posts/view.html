<!DOCTYPE html>
<html lang="ko">
<html xmlns:th=http://www.tymeleaf.org>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>게시글 읽기</title>
<!-- Bootstrap CSS 추가 -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<!-- ----- 게시글 삭제 버튼 누르면 게시글 갖고와서 삭제하는 그크립트 작성  -->
<script>
	function confirmDelete(postId) {
		if (confirm("정말 삭제하시겠습니까?")) {
			//url 이동 시키는 기능
			location.href = '/posts/remove/' + postId;
		}
	}
</script>
</head>
<body>
	<!-- 네비게이션 바 -->
	<div th:replace="~{navi :: navi}"></div>

	<div class="container my-5">
		<h2>게시글 읽기</h2>

		<!-- 게시글 상세 내용 -->
		<div class="card">
			<div class="card-header">
				<!-- 게시글 제목 -->
				<h3 th:text="${post.title}">제목</h3>
			</div>
			<div class="card-body">
				<!-- 게시글 내용 -->
				<p th:text="${post.content}">내용</p>
			</div>
			<!-- 첨부파일 표시 -->
			<div class = "mb-4">
				<label class="form-label">첨부파일</label>
				<ul>
					<il th:if="${post.fileAttachment}">
						<a th:href="@{/posts/{postId}/download/{fileAttachmentId}
						(postId=${post.id}, fileAttachmentId=${post.fileAttachment.id})}"
						th:text ="${post.fileAttachment.originalFilename}"></a>
				</ul>
			</div>
			<div class="card-footer text-muted">
				<!-- 게시글 작성자, 조회수, 등록일 -->
				<span>작성자:[[${post.user.name}]]</span> <span>조회 수:
					[[${post.views}]]</span> <span>작성일:
					[[${#temporals.format(post.createTime, 'yyyy-MM-dd')}]]</span>
			</div>
		</div>
		<!-- 로그인 사용자와 작성자가 같을 경우에만 수정, 삭제 버튼이 보여야 한다.-->
		<th: block
			th:if="${session. loginUser != null and session. loginUser. id == post.user. id}">


			<!-- 게시글 삭제 폼 -->
			<!-- Day0122- 로그인 후 삭제
    	로그인 사용자와 작성자가 같을 경우에만 수정, 삭제 버튼이 보여야 한다. -> 다른 사람이 작성한 게시글에서는 이 삭제하기 버튼이 안보임 -->

			<th:block
				th:if="${session.loginUser != null and session.loginUser.id == post.user.id}">
				<!-- 수정하기 버튼 -->
				<a th:href="@{/posts/edit/{postId}(postId=${post.id})}"
					class="btn btn-primary mt-3">수정하기</a>


				<!--  confirmDelete는 리터럴 값 -> |confirmDelete(${post.id})|-->
				<button type="submit" class="btn btn-danger mt-3"
					th:onclick="|confirmDelete(${post.id})|">삭제하기</button>
			</th:block>

			<!-- 로그인 안하고 글 작성후 삭제하기
    <div class="mt-4">
        <h4>게시글 삭제</h4>
        <form th:action="@{/posts/remove/{id}(id=${post.id})}" method="post">
            <div class="mb-3">
                <label for="password" class="form-label">비밀번호</label>
                <input type="password" class="form-control" id="password" name="password" required>
            </div>
            <button type="submit" class="btn btn-danger">삭제하기</button>  -->
			</form>
			<!-- 뒤로 가기 버튼 -->
			<a href="/posts" class="btn btn-secondary mt-3">목록으로 돌아가기</a>
	</div>


	</div>

	<!-- Bootstrap JS 및 의존성 스크립트 추가 -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
